using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Windows.Forms;

namespace C_Malware_Scanner
{
    public partial class Form1 : Form
    {
        public Form1()
        {
            InitializeComponent();
        }
        private void fileToolStripMenuItem_Click(object sender, EventArgs e)
        {

        }

        private void listBox1_SelectedIndexChanged(object sender, EventArgs e)
        {

        }

        private void exitToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //Code for the exit button, this closes the application
            this.Close();
        }

        private void selectVirusDBToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //Code to open the dialog box to select the virus database file
            virusDBdialog.ShowDialog();
            
        }

        private void mD5CheckerToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //enable the viewchange class and give it the name view
            viewchange view = new viewchange();
            //the code below disables all of the form elements inside of form1
            view.disableAll(this);
            //the code below enables the form elements related to the md5 folder selection
            view.enableMD5folderSelection(this);
        }

        private void label1_Click(object sender, EventArgs e)
        {

        }

        private void processScannerToolStripMenuItem_Click(object sender, EventArgs e)
        {
            //enable the viewchange class and give it the name view
            viewchange view = new viewchange();
            //disable all of the form elements inside form1
            view.disableAll(this);
            //enable the form elements related to the process list
            view.enableProcessList(this);
        }

        private void selectFolderMD5_Click(object sender, EventArgs e)
        {
            //this code shows the folder selection dialog when the select folder button is pressed
            md5FolderSelection.ShowDialog();
            //if the path selected is not null (the user has selected a folder) then change the label to the path selected
            //refresh the label and then enable the scan button
            if (md5FolderSelection.SelectedPath != "")
            {
                MD5Label.Text = md5FolderSelection.SelectedPath.ToString();
                MD5Label.Refresh();
                MD5ScanButton.Enabled = true;
                MD5ScanButton.Refresh();
            }
        }

        private void ProcessListScanButton_Click(object sender, EventArgs e)
        {
            processscanner scan = new processscanner();
            scan.processscan(this);
            if (ProcessListBox.Items.Count != 0)
            {
                MessageBox.Show("MyPC Backup.exe Detected");
            }
            else
            {
                MessageBox.Show("No Malicious Processes Detected");
            }
        }

        private void MD5ScanButton_Click(object sender, EventArgs e)
        {
            if (md5FolderSelection.SelectedPath != ""){
                selectFolderMD5.Enabled = false;
                selectFolderMD5.Refresh();
                MD5ScanButton.Enabled = false;
                MD5ScanButton.Refresh();
                MD5ScanListBox.Visible = true;
                MD5ScanListBox.Refresh();
                toolStripStatusLabel1.Text = "MD5 Scan in Progress";
                MD5Label.Visible = false;
                MD5Label.Refresh();
                md5scanner scan = new md5scanner();
                scan.createMD5ForFilesInDir(md5FolderSelection.SelectedPath, this, virusDBdialog.FileName);
                toolStripStatusLabel1.Text = "MD5 Scan Complete";
                if (MD5ScanListBox.Items.Count != 0) 
                {
                    MessageBox.Show("Virus Detected!");
                }
                else
                {
                    MessageBox.Show("No Virus Detected");
                }

            }
            else
            {
                MessageBox.Show("No Folder Selected");
            }
           
        }
    }
}
