using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Security.Cryptography;
using System.IO;

namespace C_Malware_Scanner
{
    class md5scanner
    {
        private bool checkMD5(string mMd5)
        {
            return true;
        }
        public void createMD5ForFilesInDir(string dir, Form1 form)
        {
            foreach (string filestream in System.IO.Directory.GetFiles(dir))
            {
                try
                {
                    var md5 = MD5.Create();
                    var file = System.IO.File.OpenRead(filestream);
                    string md5check = BitConverter.ToString(md5.ComputeHash(file)).Replace("-", "").ToLower();
                    form.MD5ScanListBox.Items.Add(md5check);
                    md5.Dispose();
                }
                catch (System.UnauthorizedAccessException e)
                {
                    //toolStripStatusLabel3.Text = "Could not access file ";
                    //statusStrip1.Refresh();
                    //MessageBox.Show("Could not access file " + f);
                    //button1.Text = "Scan Now";
                    //button1.Enabled = true;
                    //button2.Enabled = true;
                    //button1.Refresh();
                    //button2.Refresh();
                }
                foreach (string d in System.IO.Directory.GetDirectories(dir))
                {
                    foreach (string f in System.IO.Directory.GetFiles(d))
                    {
                        try
                        {
                            var md5 = MD5.Create();
                            var file = System.IO.File.OpenRead(f);
                            string md5check = BitConverter.ToString(md5.ComputeHash(file)).Replace("-", "").ToLower();
                            form.MD5ScanListBox.Items.Add(md5check);
                            md5.Dispose();
                        }
                        catch (System.UnauthorizedAccessException e)
                        {
                            //toolStripStatusLabel3.Text = "Could not access file ";
                            //statusStrip1.Refresh();
                            //MessageBox.Show("Could not access file " + f);
                            //button1.Text = "Scan Now";
                            //button1.Enabled = true;
                            //button2.Enabled = true;
                            //button1.Refresh();
                            //button2.Refresh();
                        }
                    }
                }

            }
        }
    }
}

